%define glib_ver 2.32

Name:		mongo-glib
Version:	@VERSION@
Release:	1%{?dist}
Summary:	Library for connecting to or emulating MongoDB.

Group:		System Environment/Libraries
License:	LGPLv2+
URL:		https://github.com/chergert/mongo-glib
Source0:	https://github.com/downloads/chergert/mongo-glib/mongo-glib-@VERSION@.tar.xz
BuildRoot:	%{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

BuildRequires:	glib2-devel >= %{glib_ver}
BuildRequires:	libunistring-devel
BuildRequires:	gobject-introspection-devel
Requires:	libunistring

%description
%{name} is a library for communicating using the MongoDB wire protocol. You
can either connect to a MongoDB server or emulate the features of a MongoDB
server by talking the server portion of the protocol. The library supports
auto-reconnect and replica sets.


%package devel
Summary:	Development files for %{name}
Group:		Development/Libraries
Requires:	%{name} >= %{version}-%{release}
Requires:	glib2-devel >= %{glib_ver}
Requires:	gtk-doc
Requires:	pkgconfig


%description devel
The %{name}-devel package contains libraries and header files for
developing applications that use %{name}.


%prep
%setup -q -n %{name}-%{version}


%build
%configure --enable-static=no --enable-gtk-doc
make %{?_smp_mflags} V=1


%install
rm -rf $RPM_BUILD_ROOT
make install DESTDIR=$RPM_BUILD_ROOT
find $RPM_BUILD_ROOT -name '*.la' -exec rm -f {} ';'


# Copy the files from the tarball to avoid the IDs generated by gtk-doc being
# different on different builds
mkdir -p $RPM_BUILD_ROOT%{_datadir}/gtk-doc/html/%{name}/
cp -a doc/html/* $RPM_BUILD_ROOT%{_datadir}/gtk-doc/html/%{name}/


%check
# make check


%clean
rm -rf $RPM_BUILD_ROOT


%post -p /sbin/ldconfig


%postun -p /sbin/ldconfig


%files
%defattr(-,root,root,-)
%doc COPYING NEWS README.md
%{_libdir}/lib%{name}*.so.*
%{_libdir}/girepository-1.0/Mongo-1.0.typelib


%files devel
%defattr(-,root,root,-)
%{_libdir}/lib%{name}*.so
%{_libdir}/pkgconfig/%{name}-1.0.pc
%{_includedir}/%{name}-1.0/
%{_datadir}/gtk-doc/html/%{name}/
%{_datadir}/gir-1.0/Mongo-1.0.gir


%changelog
